WEBVTT

1
00:00:00.480 --> 00:00:02.280
<v Instructor>Okay, so let's practice using</v>

2
00:00:02.280 --> 00:00:03.113
auto scaling groups.

3
00:00:03.113 --> 00:00:05.040
To do so, first of all, please make sure

4
00:00:05.040 --> 00:00:07.650
to take your instances and terminate them all

5
00:00:07.650 --> 00:00:11.760
to have zero instances running in EC2.

6
00:00:11.760 --> 00:00:14.280
Okay, so next we have to create an auto scaling group.

7
00:00:14.280 --> 00:00:17.280
So let's go into auto scaling groups on the left hand side

8
00:00:17.280 --> 00:00:19.470
and we're going to create our first auto scaling group.

9
00:00:19.470 --> 00:00:21.030
So create auto scaling group.

10
00:00:21.030 --> 00:00:24.270
Let's name our auto scaling group Demo ASG.

11
00:00:24.270 --> 00:00:26.340
And we need to refer to a launch template.

12
00:00:26.340 --> 00:00:29.223
So I'm going to create a launch template right now.

13
00:00:30.660 --> 00:00:31.680
So when you create a launch template,

14
00:00:31.680 --> 00:00:32.610
you need to give it a name.

15
00:00:32.610 --> 00:00:35.680
I will give it my demo template

16
00:00:36.870 --> 00:00:40.800
as well as a description, templates.

17
00:00:40.800 --> 00:00:44.010
Okay, so we're going to scroll down

18
00:00:44.010 --> 00:00:45.930
and specify different options.

19
00:00:45.930 --> 00:00:48.990
So for the Amazon Machine image I'm going to use,

20
00:00:48.990 --> 00:00:51.300
I'm going to go into quick start, Amazon Linux.

21
00:00:51.300 --> 00:00:54.933
I will choose Amazon Linux 2 in the version X86.

22
00:00:56.160 --> 00:00:58.650
And we'll use a free tier eligible AMI.

23
00:00:58.650 --> 00:00:59.880
So that's good.

24
00:00:59.880 --> 00:01:02.970
Next, for instance type, I'm going to select t2 micro

25
00:01:02.970 --> 00:01:04.380
because it is free tier eligible.

26
00:01:04.380 --> 00:01:06.810
So anything free tier eligible is good.

27
00:01:06.810 --> 00:01:07.830
And I will scroll down.

28
00:01:07.830 --> 00:01:10.980
In terms of key pair, I will include EC2 tutorial.

29
00:01:10.980 --> 00:01:12.840
So this is defining pretty much

30
00:01:12.840 --> 00:01:16.020
how EC2 instances within my launch template

31
00:01:16.020 --> 00:01:18.960
and therefore within my ASG should be launched.

32
00:01:18.960 --> 00:01:20.760
Okay, so the options are very similar

33
00:01:20.760 --> 00:01:23.790
to the ones you've seen when you launch an EC2 instance

34
00:01:23.790 --> 00:01:24.623
on its own.

35
00:01:25.590 --> 00:01:28.920
For subnets, you don't include it in the launch templates.

36
00:01:28.920 --> 00:01:30.030
For a firewall security group,

37
00:01:30.030 --> 00:01:31.200
you can select an existing one.

38
00:01:31.200 --> 00:01:34.200
For example, your launch wizard 1.

39
00:01:34.200 --> 00:01:36.750
You have eight gigabytes of gp2 volume.

40
00:01:36.750 --> 00:01:37.890
This is good.

41
00:01:37.890 --> 00:01:40.200
And then for advanced details,

42
00:01:40.200 --> 00:01:42.510
I'm going to scroll all the way down

43
00:01:42.510 --> 00:01:44.760
and I will find my user data.

44
00:01:44.760 --> 00:01:47.910
And for user data, I'm going to input the user data

45
00:01:47.910 --> 00:01:49.140
we used from before.

46
00:01:49.140 --> 00:01:50.157
So all of it.

47
00:01:50.157 --> 00:01:52.740
And this is going to allow a web server

48
00:01:52.740 --> 00:01:56.583
to be created on every EC2 instance as part of this ASG.

49
00:01:57.600 --> 00:01:58.433
So we're good to go.

50
00:01:58.433 --> 00:01:59.850
Let's create this launch template.

51
00:01:59.850 --> 00:02:01.890
It has been created called the my demo template.

52
00:02:01.890 --> 00:02:04.950
I'm going to refresh it and select it right here.

53
00:02:04.950 --> 00:02:07.950
So we have my demo template version one.

54
00:02:07.950 --> 00:02:09.480
We have the summary of it

55
00:02:09.480 --> 00:02:12.180
and we click on next to keep on going.

56
00:02:12.180 --> 00:02:14.880
So we choose the instance launch options,

57
00:02:14.880 --> 00:02:17.970
and the first thing is around instance type requirements.

58
00:02:17.970 --> 00:02:20.940
So we can override the launch template if we wanted to

59
00:02:20.940 --> 00:02:23.250
and be very specific around the types

60
00:02:23.250 --> 00:02:25.440
of the EC2 instances we may want.

61
00:02:25.440 --> 00:02:28.530
Now all the options are very advanced.

62
00:02:28.530 --> 00:02:30.030
We can have a look on your own time,

63
00:02:30.030 --> 00:02:32.820
but we're just going to click on reset to launch templates.

64
00:02:32.820 --> 00:02:35.070
And the only instance type we're going to create

65
00:02:35.070 --> 00:02:37.080
is a t2 micro.

66
00:02:37.080 --> 00:02:39.900
Then we have under network a VPC,

67
00:02:39.900 --> 00:02:41.460
and then we select multiple AZ

68
00:02:41.460 --> 00:02:43.410
to launch our instances there.

69
00:02:43.410 --> 00:02:46.050
And for AZ distribution, we're going to keep it

70
00:02:46.050 --> 00:02:48.330
as balanced best effort.

71
00:02:48.330 --> 00:02:49.740
So this ensures that our instances

72
00:02:49.740 --> 00:02:51.930
are spread across three AZ.

73
00:02:51.930 --> 00:02:55.470
Next we have optionally integration with a load balancer.

74
00:02:55.470 --> 00:02:57.060
And so because we have created one before,

75
00:02:57.060 --> 00:02:58.710
we may want our instances

76
00:02:58.710 --> 00:03:00.990
and we want our instances to be attached

77
00:03:00.990 --> 00:03:02.820
to an existing load balancer.

78
00:03:02.820 --> 00:03:04.770
So to do so, we just attach it

79
00:03:04.770 --> 00:03:06.750
to a load balancer target group

80
00:03:06.750 --> 00:03:10.800
and we're going to choose the demo tg alb load balancer

81
00:03:10.800 --> 00:03:12.570
that we have created from before.

82
00:03:12.570 --> 00:03:16.170
So now we have all our instances from our ASG attached

83
00:03:16.170 --> 00:03:19.410
to the load balancer through this target group.

84
00:03:19.410 --> 00:03:23.070
We don't do anything for VPC Lattice integration,

85
00:03:23.070 --> 00:03:25.830
we don't do anything for the zonal shift

86
00:03:25.830 --> 00:03:27.900
and for health checks, we're going to enable

87
00:03:27.900 --> 00:03:28.830
the EC2 health checks

88
00:03:28.830 --> 00:03:31.530
as well as the load balancer health checks.

89
00:03:31.530 --> 00:03:34.080
So that's our load balancer.

90
00:03:34.080 --> 00:03:37.680
Actually will also check the health of our EC2 instances

91
00:03:37.680 --> 00:03:40.110
and our ASG can terminate these instances

92
00:03:40.110 --> 00:03:42.540
in case they are unhealthy.

93
00:03:42.540 --> 00:03:43.650
Click on next.

94
00:03:43.650 --> 00:03:45.840
We leave everything for desired capacity

95
00:03:45.840 --> 00:03:49.830
min and max capacity to one, we'll see scaling in a moment.

96
00:03:49.830 --> 00:03:51.870
We don't do anything for automatic scaling.

97
00:03:51.870 --> 00:03:54.510
We'll have a look at it later as well.

98
00:03:54.510 --> 00:03:56.490
And for instance maintenance policy,

99
00:03:56.490 --> 00:03:58.350
we just have no policy.

100
00:03:58.350 --> 00:04:01.530
We'll use default for additional capacity setting

101
00:04:01.530 --> 00:04:04.770
and we don't touch any of the additional settings.

102
00:04:04.770 --> 00:04:06.150
So we review notifications,

103
00:04:06.150 --> 00:04:09.000
we don't want any and we don't need any tags.

104
00:04:09.000 --> 00:04:12.030
And then when we're good to go, we review all these options

105
00:04:12.030 --> 00:04:14.493
and then we click on create auto scaling group.

106
00:04:16.590 --> 00:04:20.130
Okay, so my auto scaling group is created

107
00:04:20.130 --> 00:04:22.680
and what it's going to do is that it's going to create

108
00:04:22.680 --> 00:04:25.590
one EC2 instance for me.

109
00:04:25.590 --> 00:04:28.920
So the idea here is that if I click on my auto scaling group

110
00:04:28.920 --> 00:04:31.410
and we get some details, we can see the desired

111
00:04:31.410 --> 00:04:34.500
min and max capacity as well as the launch template

112
00:04:34.500 --> 00:04:36.753
that was used for this ASG.

113
00:04:37.680 --> 00:04:39.660
And then if I go into activity,

114
00:04:39.660 --> 00:04:42.300
this is where the interesting stuff happens.

115
00:04:42.300 --> 00:04:47.250
So when the ASG will decide to create an EC2 instance,

116
00:04:47.250 --> 00:04:50.310
it's going to appear in the activity notification.

117
00:04:50.310 --> 00:04:53.160
So if I refresh this very soon, sorry,

118
00:04:53.160 --> 00:04:54.900
in the activity history,

119
00:04:54.900 --> 00:04:57.150
so if I refresh the activity history,

120
00:04:57.150 --> 00:04:59.790
then I can see that there is a launching

121
00:04:59.790 --> 00:05:01.350
a new instance right here

122
00:05:01.350 --> 00:05:04.560
because the auto scaling group has a capacity of zero

123
00:05:04.560 --> 00:05:06.270
and we wanted one capacity.

124
00:05:06.270 --> 00:05:09.270
So it's just increasing the number of EC2 instances

125
00:05:09.270 --> 00:05:12.570
in our ASG to match the desired capacity.

126
00:05:12.570 --> 00:05:15.840
So if I go to the tab instance management, as we can see,

127
00:05:15.840 --> 00:05:19.110
one EC2 instance was created by the ASG.

128
00:05:19.110 --> 00:05:21.810
And so if we go to the instances tab right here,

129
00:05:21.810 --> 00:05:25.170
we can see that the EC2 instance is currently running

130
00:05:25.170 --> 00:05:26.670
and initializing.

131
00:05:26.670 --> 00:05:27.930
So it's pretty cool.

132
00:05:27.930 --> 00:05:30.240
Now the cool thing is that because we had set up

133
00:05:30.240 --> 00:05:33.450
our ASG to be linked to our target groups,

134
00:05:33.450 --> 00:05:36.820
then if we go to the target groups on the left hand side

135
00:05:39.000 --> 00:05:40.980
and find my first target group

136
00:05:40.980 --> 00:05:44.400
and go to targets, my EC2 instance is being,

137
00:05:44.400 --> 00:05:45.690
and I will just expand it.

138
00:05:45.690 --> 00:05:49.680
My EC2 instance is being registered into my ALB.

139
00:05:49.680 --> 00:05:51.900
So right now it shows that as unhealthy

140
00:05:51.900 --> 00:05:53.340
because the objects are failing

141
00:05:53.340 --> 00:05:56.790
because the EC2 instance is still bootstrapping,

142
00:05:56.790 --> 00:06:01.650
but if after a bit it passes, it will be shown as healthy

143
00:06:01.650 --> 00:06:04.350
and then will be registered into my ALB.

144
00:06:04.350 --> 00:06:06.810
So let me pause the video to wait for that.

145
00:06:06.810 --> 00:06:09.720
Okay, so my instance is now healthy,

146
00:06:09.720 --> 00:06:11.970
and then if I go to my ALB

147
00:06:11.970 --> 00:06:14.820
and refresh, I get the hello world response.

148
00:06:14.820 --> 00:06:16.590
That means that everything is functioning.

149
00:06:16.590 --> 00:06:19.380
The instance was created by an ASG,

150
00:06:19.380 --> 00:06:21.480
we can see it in the EC2 console.

151
00:06:21.480 --> 00:06:24.090
It was registered into the target group, which is linked

152
00:06:24.090 --> 00:06:26.340
to our load balancer and therefore our load balancer

153
00:06:26.340 --> 00:06:28.020
is fully working.

154
00:06:28.020 --> 00:06:31.530
Now if the instance never gets healthy, it gets unhealthy,

155
00:06:31.530 --> 00:06:33.330
then because we set up our ASG

156
00:06:33.330 --> 00:06:34.980
to terminate unhealthy instances,

157
00:06:34.980 --> 00:06:36.600
what you're going to see is that the instance

158
00:06:36.600 --> 00:06:39.960
is going to be terminated and a new one will be created.

159
00:06:39.960 --> 00:06:43.050
So you will see this mostly in the activity history.

160
00:06:43.050 --> 00:06:46.170
If you do have this, the reason why this is happening

161
00:06:46.170 --> 00:06:49.230
is that your EC2 instance is misconfigured.

162
00:06:49.230 --> 00:06:52.050
This could be either a security group issue

163
00:06:52.050 --> 00:06:54.540
or it could be an EC2 user data script issue.

164
00:06:54.540 --> 00:06:55.800
So please check those

165
00:06:55.800 --> 00:06:58.290
before asking questions in the Q&amp;A.

166
00:06:58.290 --> 00:07:00.780
But these are the errors that you should be having.

167
00:07:00.780 --> 00:07:05.310
So now we have one EC2 instance and it's in service.

168
00:07:05.310 --> 00:07:08.280
And what we could do is that we can experience the scaling

169
00:07:08.280 --> 00:07:10.590
by editing the auto scaling group size.

170
00:07:10.590 --> 00:07:12.690
So we want two instances

171
00:07:12.690 --> 00:07:15.300
and so we have to increase the maximum capacity as well.

172
00:07:15.300 --> 00:07:17.070
So we'll update this.

173
00:07:17.070 --> 00:07:21.030
And now what we told the ASG is that we want you to create

174
00:07:21.030 --> 00:07:23.610
one or more EC2 instance for us.

175
00:07:23.610 --> 00:07:26.370
So if you go to the activity history

176
00:07:26.370 --> 00:07:28.113
and then refresh it,

177
00:07:29.250 --> 00:07:32.310
very soon is going to show a new activity

178
00:07:32.310 --> 00:07:35.220
that it will be trying to be launching an EC2 instance.

179
00:07:35.220 --> 00:07:36.150
So here we go.

180
00:07:36.150 --> 00:07:38.400
Now it says launching a new EC2 instance

181
00:07:38.400 --> 00:07:40.800
because you have changed the desired capacity

182
00:07:40.800 --> 00:07:42.030
from one to two.

183
00:07:42.030 --> 00:07:43.807
And the actual number of instances

184
00:07:43.807 --> 00:07:46.290
in our ASG was only one.

185
00:07:46.290 --> 00:07:48.960
So now as you can see, we have a second EC2 instance

186
00:07:48.960 --> 00:07:51.660
being created and after a while

187
00:07:51.660 --> 00:07:52.770
it's going to be registered

188
00:07:52.770 --> 00:07:55.650
into our target group and added.

189
00:07:55.650 --> 00:07:58.800
So we'll post the video for this process to happen.

190
00:07:58.800 --> 00:08:01.230
Okay, so my instance is now healthy.

191
00:08:01.230 --> 00:08:04.260
And so if I go to my ALB and refresh, as we can see,

192
00:08:04.260 --> 00:08:07.830
I got my two IPs that are looping through my ALB.

193
00:08:07.830 --> 00:08:09.840
So everything is working great.

194
00:08:09.840 --> 00:08:11.070
And so one last thing.

195
00:08:11.070 --> 00:08:14.040
So if we go to activities, we can see the two EC2 instances

196
00:08:14.040 --> 00:08:15.270
were launched successfully.

197
00:08:15.270 --> 00:08:16.680
Now let's go through the opposite.

198
00:08:16.680 --> 00:08:19.440
We're going to scale down our capacity

199
00:08:19.440 --> 00:08:23.310
by putting the desire capacity back to one and update it.

200
00:08:23.310 --> 00:08:25.260
And what this will do is that it will say,

201
00:08:25.260 --> 00:08:27.840
hey, it looks like you have two instances,

202
00:08:27.840 --> 00:08:29.850
but now you need only one.

203
00:08:29.850 --> 00:08:33.210
So I'm going to pick one of these two instances right here

204
00:08:33.210 --> 00:08:34.770
and terminate them.

205
00:08:34.770 --> 00:08:37.290
So as you can see here, it says I'm terminating

206
00:08:37.290 --> 00:08:39.810
one of these instances because of the change

207
00:08:39.810 --> 00:08:42.090
of the configuration of the ASG

208
00:08:42.090 --> 00:08:43.800
and it's going to terminate the instance

209
00:08:43.800 --> 00:08:46.110
and then de register it from the target group.

210
00:08:46.110 --> 00:08:48.270
And then we'll be back with only one EC2 instance

211
00:08:48.270 --> 00:08:49.410
in our ASG.

212
00:08:49.410 --> 00:08:50.610
So that's it for this lecture.

213
00:08:50.610 --> 00:08:52.710
You've seen the whole power of ASG

214
00:08:52.710 --> 00:08:54.240
and I will see you in the next lecture

215
00:08:54.240 --> 00:08:55.983
to talk about automatic scaling.

