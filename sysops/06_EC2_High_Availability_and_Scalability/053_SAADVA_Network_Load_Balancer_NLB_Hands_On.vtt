WEBVTT

1
00:00:01.470 --> 00:00:02.640
<v Instructor>Okay, so let's go ahead</v>

2
00:00:02.640 --> 00:00:05.850
and practice creating a network load balancer.

3
00:00:05.850 --> 00:00:08.400
So let's create a network load balancer right here,

4
00:00:08.400 --> 00:00:11.490
and we're going to call this one DemoNLB.

5
00:00:11.490 --> 00:00:12.323
And so,

6
00:00:12.323 --> 00:00:15.933
we will choose an internet facing load balancer of IPv4.

7
00:00:16.830 --> 00:00:19.860
In terms of network mapping, I will use the VPC I have,

8
00:00:19.860 --> 00:00:23.400
and I will take every availability zone so the three I have.

9
00:00:23.400 --> 00:00:26.850
And as you can see for each AZ, there's a subnet.

10
00:00:26.850 --> 00:00:30.900
And then there is an IPv4 address that is assigned by AWS.

11
00:00:30.900 --> 00:00:33.600
So that means that for each AZ

12
00:00:33.600 --> 00:00:36.240
that you enable for your network load balancer,

13
00:00:36.240 --> 00:00:38.850
you're going to get a fixed IPv4 address.

14
00:00:38.850 --> 00:00:42.390
And in that case, this is going to be assigned by AWS,

15
00:00:42.390 --> 00:00:44.340
but if you had an elastic IP,

16
00:00:44.340 --> 00:00:46.770
you could use an elastic IP address instead

17
00:00:46.770 --> 00:00:49.770
for each specific availability zones.

18
00:00:49.770 --> 00:00:53.670
Okay, next we can attach a security group

19
00:00:53.670 --> 00:00:57.000
to our network load balancer, and this is recommended.

20
00:00:57.000 --> 00:00:58.020
So this is new.

21
00:00:58.020 --> 00:00:58.920
And the way we do it is

22
00:00:58.920 --> 00:01:01.170
that we can create a security group.

23
00:01:01.170 --> 00:01:05.310
I call this one demo-sg-nlb.

24
00:01:05.310 --> 00:01:06.690
And for inbound rules,

25
00:01:06.690 --> 00:01:10.430
we're going to allow anyone on port 80.

26
00:01:10.430 --> 00:01:13.623
So we'll have HTTP from anywhere,

27
00:01:14.520 --> 00:01:16.260
and outbound rules is fine.

28
00:01:16.260 --> 00:01:18.090
So let's create the security group,

29
00:01:18.090 --> 00:01:21.933
and Demo SG for NLB, we have the description.

30
00:01:24.120 --> 00:01:24.953
So we're good.

31
00:01:24.953 --> 00:01:27.300
We're going to now use this demo security group.

32
00:01:27.300 --> 00:01:32.010
So I'm going to refresh this and choose my demo-sg-nlb,

33
00:01:32.010 --> 00:01:33.750
and remove the default, okay?

34
00:01:33.750 --> 00:01:37.500
So the idea is that similarly to application load balancers,

35
00:01:37.500 --> 00:01:40.710
for network load balancers, you also attach a security group

36
00:01:40.710 --> 00:01:44.610
and then this control traffic to your network load balancer.

37
00:01:44.610 --> 00:01:47.280
In terms of listeners and routing,

38
00:01:47.280 --> 00:01:48.870
we're going to have a protocol.

39
00:01:48.870 --> 00:01:52.350
So you can use TCP, TCP_UDP, TLS, or UDP.

40
00:01:52.350 --> 00:01:54.510
We'll use TCP over port 80.

41
00:01:54.510 --> 00:01:57.480
And then we have a target group we should send it to.

42
00:01:57.480 --> 00:01:59.370
So let's create a target group.

43
00:01:59.370 --> 00:02:01.590
And this one is going to be specifically

44
00:02:01.590 --> 00:02:03.960
for a network load balancer.

45
00:02:03.960 --> 00:02:08.400
And so as such, I'm going to choose instances in here,

46
00:02:08.400 --> 00:02:13.173
and the target name is going to be called demo-tg-nlb.

47
00:02:14.280 --> 00:02:18.060
The protocol is going to be TCP on port 80,

48
00:02:18.060 --> 00:02:20.820
because we're using a network load balancer.

49
00:02:20.820 --> 00:02:23.340
And we'll use the VPC as before.

50
00:02:23.340 --> 00:02:25.170
For the health check, we have different options.

51
00:02:25.170 --> 00:02:27.630
So TCP, HTTP, or HTTPS.

52
00:02:27.630 --> 00:02:29.640
But because we have an HTTP application running

53
00:02:29.640 --> 00:02:32.340
on our EC2 instances, we'll use HTTP.

54
00:02:32.340 --> 00:02:34.740
And for the advanced health check settings,

55
00:02:34.740 --> 00:02:37.440
we'll just define the healthy threshold to be two,

56
00:02:37.440 --> 00:02:39.840
and the timeout to be two seconds,

57
00:02:39.840 --> 00:02:42.060
and the interval to be five seconds.

58
00:02:42.060 --> 00:02:43.890
So let's click on Next,

59
00:02:43.890 --> 00:02:45.750
and then we are going to register targets.

60
00:02:45.750 --> 00:02:47.490
So my two available instances,

61
00:02:47.490 --> 00:02:49.740
I'm going to click here to include them

62
00:02:49.740 --> 00:02:54.060
as pending below, and create the target group.

63
00:02:54.060 --> 00:02:58.050
So now that we have created our demo-tg-nlb,

64
00:02:58.050 --> 00:02:59.430
we can go ahead, click on it,

65
00:02:59.430 --> 00:03:01.110
to have it in a different page.

66
00:03:01.110 --> 00:03:03.330
And I'm gonna go into my network balancer,

67
00:03:03.330 --> 00:03:07.830
and refresh this, and select my demo-tg-nlb.

68
00:03:07.830 --> 00:03:08.880
Perfect.

69
00:03:08.880 --> 00:03:10.800
Now let's scroll down,

70
00:03:10.800 --> 00:03:12.600
and we have done the configuration

71
00:03:12.600 --> 00:03:14.580
of our network load balancer.

72
00:03:14.580 --> 00:03:16.650
So let's create this network load balancer

73
00:03:16.650 --> 00:03:19.890
and switch right away to its page.

74
00:03:19.890 --> 00:03:21.540
Now let's wait for it to be provisioned,

75
00:03:21.540 --> 00:03:23.070
and we're good to go.

76
00:03:23.070 --> 00:03:26.520
Okay, so my network load balancer is now active.

77
00:03:26.520 --> 00:03:30.270
And so if I enter the URL in my web browser,

78
00:03:30.270 --> 00:03:33.210
as we can see right now, it doesn't seem to work.

79
00:03:33.210 --> 00:03:34.620
So let's observe the kind

80
00:03:34.620 --> 00:03:38.340
of problems we may have with our load balancer.

81
00:03:38.340 --> 00:03:40.290
So if you look at the target group right now,

82
00:03:40.290 --> 00:03:42.420
and refresh this page,

83
00:03:42.420 --> 00:03:46.380
it looks like my instances are still in the initial phase

84
00:03:46.380 --> 00:03:47.310
of being checked.

85
00:03:47.310 --> 00:03:51.060
So let me come back and see if they're healthy or unhealthy.

86
00:03:51.060 --> 00:03:52.740
And so they are unhealthy,

87
00:03:52.740 --> 00:03:54.960
because they have checks have failed.

88
00:03:54.960 --> 00:03:58.980
So the idea is that if we look at these instances

89
00:03:58.980 --> 00:04:02.400
and we look at the security group of these instances,

90
00:04:02.400 --> 00:04:04.950
we go to Security, and then Security groups.

91
00:04:04.950 --> 00:04:06.390
So let's click on it,

92
00:04:06.390 --> 00:04:08.640
and open up the security group.

93
00:04:08.640 --> 00:04:11.070
And we can see that from the inbound rules,

94
00:04:11.070 --> 00:04:13.710
that we allow SSH from anywhere

95
00:04:13.710 --> 00:04:16.650
and we allow HTTP from this security group,

96
00:04:16.650 --> 00:04:18.930
which is, if you remember, the security group

97
00:04:18.930 --> 00:04:21.300
of our application load balancer.

98
00:04:21.300 --> 00:04:24.570
But we actually need to allow also HTTP traffic

99
00:04:24.570 --> 00:04:26.580
from our network load balancer.

100
00:04:26.580 --> 00:04:29.820
And so we need to click on demo-sg-nlb.

101
00:04:29.820 --> 00:04:32.940
So allow traffic from NLB.

102
00:04:32.940 --> 00:04:35.223
And this was allow traffic from ALB.

103
00:04:36.150 --> 00:04:39.630
And so the idea is that now with this security group rule,

104
00:04:39.630 --> 00:04:41.460
we allow the NLB

105
00:04:41.460 --> 00:04:44.370
to talk to our EC2 instances in our target group,

106
00:04:44.370 --> 00:04:45.360
and therefore,

107
00:04:45.360 --> 00:04:49.020
they should help with passing the health checks.

108
00:04:49.020 --> 00:04:50.910
So now let's just wait a little bit here

109
00:04:50.910 --> 00:04:52.653
to see if that solves our issue.

110
00:04:53.490 --> 00:04:56.910
And yes, as you can see, now my instances are healthy.

111
00:04:56.910 --> 00:04:57.743
So that means

112
00:04:57.743 --> 00:05:00.600
that if I go into my network load balancer now,

113
00:05:00.600 --> 00:05:03.240
it has resolved automatically, and we refresh,

114
00:05:03.240 --> 00:05:05.430
and we get the fact that we get a Hello World

115
00:05:05.430 --> 00:05:08.280
from a specific IP, which is our instance.

116
00:05:08.280 --> 00:05:10.590
And so after a while and refreshing, the IP changes,

117
00:05:10.590 --> 00:05:14.310
so that proves that we are load balancing to two instances.

118
00:05:14.310 --> 00:05:15.143
And that's it.

119
00:05:15.143 --> 00:05:17.310
So we've seen the security groups

120
00:05:17.310 --> 00:05:18.600
of our network load balancer.

121
00:05:18.600 --> 00:05:21.240
It works similarly to the application load balancer,

122
00:05:21.240 --> 00:05:23.910
and how to change our EC2 security group

123
00:05:23.910 --> 00:05:26.400
to really make sure that we also allow traffic

124
00:05:26.400 --> 00:05:29.130
from the NLB and not only the ALB,

125
00:05:29.130 --> 00:05:30.810
which was right here.

126
00:05:30.810 --> 00:05:33.840
Okay, so that's it for this hands-on.

127
00:05:33.840 --> 00:05:37.050
Now what you can do to prevent having some costs is

128
00:05:37.050 --> 00:05:40.383
just delete the load balancer, the DemoNLB,

129
00:05:41.310 --> 00:05:43.890
and optionally, if you wanted to,

130
00:05:43.890 --> 00:05:48.000
you could delete the demo target group,

131
00:05:48.000 --> 00:05:49.860
right here, for the NLB.

132
00:05:49.860 --> 00:05:50.730
And if you wanted to,

133
00:05:50.730 --> 00:05:53.547
you could delete also the security groups of the NLB.

134
00:05:53.547 --> 00:05:55.140
But I don't think that's necessary,

135
00:05:55.140 --> 00:05:58.230
but it's good practice if you wanted to try it out.

136
00:05:58.230 --> 00:05:59.790
Okay, so that's it for this lecture.

137
00:05:59.790 --> 00:06:00.900
I hope you liked it,

138
00:06:00.900 --> 00:06:02.913
and I will see you in the next lecture.

