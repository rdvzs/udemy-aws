WEBVTT

1
00:00:00.309 --> 00:00:01.890
<v Stephane>Okay, so let's have a look</v>

2
00:00:01.890 --> 00:00:04.290
at the different permissions for Lambda.

3
00:00:04.290 --> 00:00:06.990
So if you go into the IAM console,

4
00:00:06.990 --> 00:00:09.270
remember that every single Lambda function

5
00:00:09.270 --> 00:00:10.860
must have an IAM role.

6
00:00:10.860 --> 00:00:13.020
And so if I go into my roles

7
00:00:13.020 --> 00:00:15.750
and just look for Lambda in here,

8
00:00:15.750 --> 00:00:17.850
we can see we have a lot of Lambda roles

9
00:00:17.850 --> 00:00:19.680
right here available to us.

10
00:00:19.680 --> 00:00:22.260
So there is the demo Lambda role, the Lambda ALB,

11
00:00:22.260 --> 00:00:25.380
the Lambda S3, and we have the SQS and so on.

12
00:00:25.380 --> 00:00:27.840
So if we look at, for example, the demo Lambda role,

13
00:00:27.840 --> 00:00:30.004
which was the first role we created,

14
00:00:30.004 --> 00:00:33.030
there was a Lambda basic execution role attached to it.

15
00:00:33.030 --> 00:00:35.760
So this gets attached pretty much to every Lambda role

16
00:00:35.760 --> 00:00:38.130
that you create through the console.

17
00:00:38.130 --> 00:00:40.590
And if you look at the policy of that role itself,

18
00:00:40.590 --> 00:00:43.500
we can see that it allows you to create log groups

19
00:00:43.500 --> 00:00:46.800
and then send log events into your CloudWatch logs.

20
00:00:46.800 --> 00:00:48.210
So the idea right here is really

21
00:00:48.210 --> 00:00:51.090
to have this Lambda function being able to send logs

22
00:00:51.090 --> 00:00:51.923
into CloudWatch logs,

23
00:00:51.923 --> 00:00:54.550
and this is why it's called BasicExecutionRole, okay?

24
00:00:56.250 --> 00:00:58.950
The next thing we've seen is around resource policies.

25
00:00:58.950 --> 00:01:02.340
So for example, you can open your Lambda S3,

26
00:01:02.340 --> 00:01:04.950
Lambda EventBridge, and Lambda SQS.

27
00:01:04.950 --> 00:01:05.970
So I can show you how this works.

28
00:01:05.970 --> 00:01:09.612
So if we look at Lambda S3, and you scroll up,

29
00:01:09.612 --> 00:01:12.510
we see that S3 is logging our Lambda function.

30
00:01:12.510 --> 00:01:14.627
So we have a trigger from our S3 bucket,

31
00:01:14.627 --> 00:01:16.530
and if you go under Configuration

32
00:01:16.530 --> 00:01:19.140
and then Permissions and scroll down,

33
00:01:19.140 --> 00:01:22.680
we can see that there is a resource-based policy statement

34
00:01:22.680 --> 00:01:23.880
on our Lambda function.

35
00:01:23.880 --> 00:01:26.130
We can click on View policy,

36
00:01:26.130 --> 00:01:27.210
and by click on View policy,

37
00:01:27.210 --> 00:01:29.490
we have this entire statement,

38
00:01:29.490 --> 00:01:33.690
which is showing that we allow the Amazon S3 service

39
00:01:33.690 --> 00:01:36.060
to invoke our Lambda function,

40
00:01:36.060 --> 00:01:39.060
a condition that we are invoking this Lambda function,

41
00:01:39.060 --> 00:01:40.680
and that the source account is this

42
00:01:40.680 --> 00:01:44.490
and that the source ARN, so the ARN of our S3 bucket,

43
00:01:44.490 --> 00:01:47.220
that is invoking Lambda function is this one.

44
00:01:47.220 --> 00:01:51.450
So this is the magic that allows Amazon S3 buckets

45
00:01:51.450 --> 00:01:54.150
to invoke our Lambda function.

46
00:01:54.150 --> 00:01:56.040
If we look at the EventBridge one,

47
00:01:56.040 --> 00:01:59.280
so EventBridge is invoking our Lambda function again.

48
00:01:59.280 --> 00:02:00.750
So we need to have a look again

49
00:02:00.750 --> 00:02:02.970
at the resource-based policy statement.

50
00:02:02.970 --> 00:02:04.680
We click on View policy,

51
00:02:04.680 --> 00:02:08.820
and here we see that we allow events.amazonaws.com,

52
00:02:09.690 --> 00:02:11.610
which is EventBridge,

53
00:02:11.610 --> 00:02:13.170
to invoke our Lambda function.

54
00:02:13.170 --> 00:02:15.960
Again, being that the source ARN

55
00:02:15.960 --> 00:02:20.100
must be this rule right here on EventBridge.

56
00:02:20.100 --> 00:02:22.819
And if we look at Lambda SQS now,

57
00:02:22.819 --> 00:02:24.633
and under Configuration,

58
00:02:25.800 --> 00:02:26.633
we scroll down,

59
00:02:26.633 --> 00:02:27.466
and we see that

60
00:02:27.466 --> 00:02:29.280
there is no resource-based policy statements.

61
00:02:29.280 --> 00:02:32.160
So something is different here

62
00:02:32.160 --> 00:02:35.340
because SQS is not invoking our Lambda function.

63
00:02:35.340 --> 00:02:39.299
Instead, our Lambda function is going to query

64
00:02:39.299 --> 00:02:42.990
in SQS to see if there is data within.

65
00:02:42.990 --> 00:02:44.430
And so therefore,

66
00:02:44.430 --> 00:02:47.820
what we're looking at here instead is the execution role.

67
00:02:47.820 --> 00:02:49.140
So this is my execution role

68
00:02:49.140 --> 00:02:51.390
of my Lambda function right here.

69
00:02:51.390 --> 00:02:52.260
And if we look at it,

70
00:02:52.260 --> 00:02:57.260
we can see that we have the AWS SQS Lambda execution role,

71
00:02:58.290 --> 00:02:59.910
which allows our Lambda function

72
00:02:59.910 --> 00:03:02.975
to receive, delete, and get messages.

73
00:03:02.975 --> 00:03:06.390
If we look at Lambda SQS, here, you can also see it

74
00:03:06.390 --> 00:03:09.540
by clicking on this dropdown and clicking on Amazon SQS.

75
00:03:09.540 --> 00:03:11.574
And we see that yes, we can receive, delete,

76
00:03:11.574 --> 00:03:13.440
and get queue attributes.

77
00:03:13.440 --> 00:03:14.430
And so this is very important

78
00:03:14.430 --> 00:03:17.880
because in the SQS case,

79
00:03:17.880 --> 00:03:20.310
then Lambda is not invoked by SQS,

80
00:03:20.310 --> 00:03:24.900
but instead Lambda is getting the data out of SQS.

81
00:03:24.900 --> 00:03:26.460
So it's important for you to know.

82
00:03:26.460 --> 00:03:27.900
All right, that's it for this lecture.

83
00:03:27.900 --> 00:03:28.950
I hope that makes sense

84
00:03:28.950 --> 00:03:32.010
for resource policies versus execution roles.

85
00:03:32.010 --> 00:03:33.090
I hope you liked it,

86
00:03:33.090 --> 00:03:35.040
and I will see you in the next lecture.

