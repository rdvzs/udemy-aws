WEBVTT

1
00:00:00.250 --> 00:00:01.350
<v Instructor>Okay, so let's play</v>

2
00:00:01.350 --> 00:00:04.130
with VPC Reachability analyzer

3
00:00:04.130 --> 00:00:05.170
to understand how things work.

4
00:00:05.170 --> 00:00:07.630
So just so you know, as of this time,

5
00:00:07.630 --> 00:00:10.840
so if you look at reachability analyzer pricing,

6
00:00:10.840 --> 00:00:14.630
there is a 10 cents analysis every time you run one.

7
00:00:14.630 --> 00:00:16.530
So let me just show you, here we go.

8
00:00:16.530 --> 00:00:19.180
So the Amazon VPC whichever the two analyzer

9
00:00:19.180 --> 00:00:22.220
is costing 10 cents per analysis.

10
00:00:22.220 --> 00:00:24.020
And the goal is for you not to run analysis all the time

11
00:00:24.020 --> 00:00:25.770
this is why they have a small cost on it.

12
00:00:25.770 --> 00:00:26.603
So just so you know,

13
00:00:26.603 --> 00:00:28.940
if you go ahead and run some rules with me

14
00:00:28.940 --> 00:00:30.780
as some analysis, that is going

15
00:00:30.780 --> 00:00:32.020
to cost you a little bit of money.

16
00:00:32.020 --> 00:00:34.220
So let's create an analyze a path.

17
00:00:34.220 --> 00:00:38.640
And so here I need to enable a source and a destination.

18
00:00:38.640 --> 00:00:40.610
So the source could be any of these things.

19
00:00:40.610 --> 00:00:42.690
So it could be an instance, transit gateway,

20
00:00:42.690 --> 00:00:44.040
internet gateway, VPC endpoints.

21
00:00:44.040 --> 00:00:45.110
All of these kind of things can be

22
00:00:45.110 --> 00:00:48.290
sources so let's use an instance and then I will choose,

23
00:00:48.290 --> 00:00:50.190
for example, my BastionHost.

24
00:00:50.190 --> 00:00:53.470
Okay and we can optionally specify the source IP address,

25
00:00:53.470 --> 00:00:55.500
but as you can see, I don't need to because, well,

26
00:00:55.500 --> 00:00:57.890
the two instance has a source IP address.

27
00:00:57.890 --> 00:00:59.040
And then for destination, again,

28
00:00:59.040 --> 00:01:01.540
instance, I will choose my private instance.

29
00:01:01.540 --> 00:01:02.750
And we're good to go.

30
00:01:02.750 --> 00:01:04.580
We can also specify a destination port.

31
00:01:04.580 --> 00:01:07.130
So to evaluate whether or not a port is accessible.

32
00:01:07.130 --> 00:01:11.140
An electric access port 80, port 443.

33
00:01:11.140 --> 00:01:16.140
Okay, on my private instance, using the TCP protocol.

34
00:01:16.300 --> 00:01:18.330
So let's create an analyze this path.

35
00:01:18.330 --> 00:01:21.030
Now the requests and analysis was succeeded.

36
00:01:21.030 --> 00:01:24.300
And remember, this does not actually sends it network data,

37
00:01:24.300 --> 00:01:26.330
it just analyzes the path, okay.

38
00:01:26.330 --> 00:01:28.740
And this analysis, let me refresh it.

39
00:01:28.740 --> 00:01:32.950
So it has pending and it turns out that it's not reachable.

40
00:01:32.950 --> 00:01:33.783
So how do we know it?

41
00:01:33.783 --> 00:01:37.370
Well, we are going to click on this analysis right here.

42
00:01:37.370 --> 00:01:38.860
I'm going to click on it.

43
00:01:38.860 --> 00:01:41.650
And then there is the analysis explorer

44
00:01:41.650 --> 00:01:43.290
and there are the explanations.

45
00:01:43.290 --> 00:01:45.540
And it turns out that there is an ENI

46
00:01:45.540 --> 00:01:46.900
as your rules mismatch.

47
00:01:46.900 --> 00:01:50.020
And so this is telling you where there is a problem.

48
00:01:50.020 --> 00:01:52.940
So it turns out that's none of the English rules

49
00:01:52.940 --> 00:01:54.760
in the following security group apply.

50
00:01:54.760 --> 00:01:57.250
So that means that we haven't enabled 443

51
00:01:57.250 --> 00:01:58.190
on my security group.

52
00:01:58.190 --> 00:02:01.500
So if I go into my security group in here and look at it

53
00:02:01.500 --> 00:02:04.110
in DDS, there's only SSH on port 22.

54
00:02:04.110 --> 00:02:05.540
There's no HTTPS.

55
00:02:05.540 --> 00:02:08.250
So I could indeed edit the rules at a rule

56
00:02:08.250 --> 00:02:13.250
and then have HTTPS and then from anywhere

57
00:02:13.450 --> 00:02:15.920
and then save rules and here we go.

58
00:02:15.920 --> 00:02:19.250
So now if I go again in this and want

59
00:02:19.250 --> 00:02:20.690
to rerun this analysis,

60
00:02:20.690 --> 00:02:24.563
so what I can do is I can do analyze the path, yet again.

61
00:02:25.540 --> 00:02:27.023
And confirm.

62
00:02:29.550 --> 00:02:31.690
It's going to launch a second analysis okay.

63
00:02:31.690 --> 00:02:34.420
Which has pending and it turns out that

64
00:02:34.420 --> 00:02:36.450
now my instance is reachable.

65
00:02:36.450 --> 00:02:37.283
So this is good.

66
00:02:37.283 --> 00:02:39.010
This is fixed and we can have a look at the path.

67
00:02:39.010 --> 00:02:40.580
So this is all the things you went through.

68
00:02:40.580 --> 00:02:43.650
So this instance to an ENI to a security group

69
00:02:43.650 --> 00:02:45.230
to a network SEL to a network SEL

70
00:02:45.230 --> 00:02:48.470
to a security groups in ENI to the institute instance

71
00:02:48.470 --> 00:02:51.080
and we can have a look at the reverse path as well, okay.

72
00:02:51.080 --> 00:02:52.810
So let's do another little scenario.

73
00:02:52.810 --> 00:02:55.040
So let's go into RVPC.

74
00:02:55.040 --> 00:02:57.077
I'm going to go into my Network ACLs

75
00:02:57.077 --> 00:02:58.810
and I'm going to edit a rule.

76
00:02:58.810 --> 00:03:02.190
So for example, I'm going to, in my default NACL,

77
00:03:02.190 --> 00:03:05.560
I'm going to change some inbound rules, okay.

78
00:03:05.560 --> 00:03:10.560
And I'm going to say, that's all traffic on HTTPS.

79
00:03:10.640 --> 00:03:13.570
So and then you have this here on rule number 80

80
00:03:13.570 --> 00:03:14.460
is going to be denied.

81
00:03:14.460 --> 00:03:17.230
So we're going deny the HTTPS explicitly.

82
00:03:17.230 --> 00:03:21.860
And again, what we're going to do is run this analyzer.

83
00:03:21.860 --> 00:03:23.690
And again, this cost me 10 cents every time I do it.

84
00:03:23.690 --> 00:03:26.370
So I'm doing it because I have a big budget for this course,

85
00:03:26.370 --> 00:03:28.600
but obviously I'd be careful as you're doing it on your own.

86
00:03:28.600 --> 00:03:29.450
Okay.

87
00:03:29.450 --> 00:03:30.283
And so again,

88
00:03:30.283 --> 00:03:33.100
this is pending and let's have a look at the analysis

89
00:03:33.100 --> 00:03:35.790
and now we are in not reachable space.

90
00:03:35.790 --> 00:03:37.350
And if you look at the analysis itself,

91
00:03:37.350 --> 00:03:39.520
it says the destination is not reachable.

92
00:03:39.520 --> 00:03:42.000
And the network ACL does not allow inbound traffic

93
00:03:42.000 --> 00:03:43.670
from the subnets to VPC.

94
00:03:43.670 --> 00:03:45.020
See this.

95
00:03:45.020 --> 00:03:47.520
And so, again, it knows the network ACL

96
00:03:47.520 --> 00:03:48.550
that is not working.

97
00:03:48.550 --> 00:03:51.620
And so therefore what I have to do is just, again,

98
00:03:51.620 --> 00:03:54.520
change the inbound rules, edit them.

99
00:03:54.520 --> 00:03:56.330
And then obviously we need to remove this rule

100
00:03:56.330 --> 00:03:57.560
to make it work, okay.

101
00:03:57.560 --> 00:03:59.310
But this is really cool because all of these kind

102
00:03:59.310 --> 00:04:01.420
of like analysis to make sure that your instance

103
00:04:01.420 --> 00:04:04.210
is going to be accessible and stuff, you know,

104
00:04:04.210 --> 00:04:07.040
you have a really, really powerful tool here

105
00:04:07.040 --> 00:04:08.810
with a reachability analyzer to understand

106
00:04:08.810 --> 00:04:10.080
why it's happening.

107
00:04:10.080 --> 00:04:11.860
And especially if your network topology

108
00:04:11.860 --> 00:04:13.000
becomes very complex.

109
00:04:13.000 --> 00:04:16.580
As we learn about NAT gateways, internet gateways,

110
00:04:16.580 --> 00:04:18.880
egress only gateways, transit gateways,

111
00:04:18.880 --> 00:04:19.713
all of these kinds of things.

112
00:04:19.713 --> 00:04:21.240
It can be very complicated to debug.

113
00:04:21.240 --> 00:04:23.020
And this is a very handy tool from AWS

114
00:04:23.020 --> 00:04:24.820
to have a look at this, okay.

115
00:04:24.820 --> 00:04:26.220
So that's it, I hope you liked it.

116
00:04:26.220 --> 00:04:28.210
And I will see you in the next lecture.

